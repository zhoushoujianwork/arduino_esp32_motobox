# Info命令音频输出增强 & Air780EG MQTT恢复

## 改进内容

### 1. Info命令增强 - 音频设备信息

为`info`命令添加了详细的音频设备状态输出：

#### 新增音频信息输出
```
--- 音频设备状态 ---
音频系统: ✅ 就绪
音频引脚: WS=23, BCLK=22, DATA=21
音频芯片: NS4168 功率放大器
采样率: 16kHz
位深度: 16位
声道: 单声道
支持事件: 开机音/WiFi连接音/GPS定位音/低电量音/睡眠音
```

#### 音频故障诊断信息
当音频系统未就绪时，会显示：
```
音频系统: ❌ 未就绪
⚠️ 音频系统未就绪，请检查:
  1. I2S引脚连接是否正确
  2. NS4168芯片是否正常工作
  3. 音频引脚是否与其他功能冲突
```

### 2. Air780EG MQTT功能恢复

#### 配置修改
- ✅ 在`platformio.ini`中注释掉了`-D DISABLE_MQTT`
- ✅ 恢复了Air780EG环境的MQTT功能

#### Info命令中的GSM/MQTT状态
```
--- 连接状态 ---
WiFi状态: 未连接
BLE状态: 未连接
GSM状态: ✅ 就绪
网络状态: 已连接
信号强度: 25
```

### 3. 新增串口命令

#### 音频测试命令
```bash
audio.test      # 播放测试音频序列
audio.boot      # 播放开机成功音
audio.wifi      # 播放WiFi连接音
audio.gps       # 播放GPS定位音
audio.battery   # 播放低电量音
audio.sleep     # 播放睡眠音
audio.help      # 显示音频命令帮助
```

#### MQTT管理命令
```bash
mqtt.status     # 显示MQTT连接状态和配置
mqtt.connect    # 尝试连接MQTT
mqtt.disconnect # 断开MQTT连接
mqtt.test       # 发送MQTT测试消息
mqtt.help       # 显示MQTT命令帮助
```

## 使用示例

### 1. 查看完整设备信息
```bash
info
```

输出示例：
```
=== 设备信息 ===
设备ID: ESP32_XXXXXX
固件版本: v2.3.0
硬件版本: v1.0.0
启动次数: 5
运行时间: 120 秒

--- 连接状态 ---
WiFi状态: 未连接
BLE状态: 已连接
GSM状态: ✅ 就绪
网络状态: 已连接
信号强度: 25

--- 传感器状态 ---
GPS状态: ✅ 就绪
IMU状态: ✅ 就绪

--- 音频设备状态 ---
音频系统: ✅ 就绪
音频引脚: WS=23, BCLK=22, DATA=21
音频芯片: NS4168 功率放大器
采样率: 16kHz
位深度: 16位
声道: 单声道
支持事件: 开机音/WiFi连接音/GPS定位音/低电量音/睡眠音

--- 电源状态 ---
电池电压: 3800 mV
电池电量: 85%
充电状态: 未充电
外部电源: 未连接
```

### 2. 测试音频系统
```bash
audio.test      # 播放完整测试序列
audio.boot      # 测试开机音
```

### 3. 检查MQTT状态
```bash
mqtt.status     # 查看MQTT连接状态
mqtt.test       # 发送测试消息
```

## 技术细节

### 音频系统检测逻辑
- 检查`device_state.audioReady`状态
- 显示I2S引脚配置信息
- 提供故障排除建议

### MQTT状态检测
- 检查GSM模块状态
- 显示网络连接状态和信号强度
- 提供MQTT连接管理功能

### 命令解析增强
- 支持点号分隔的命令格式（如`audio.test`）
- 提供详细的帮助信息
- 错误处理和状态检查

## 编译和测试

1. **编译上传**：
   ```bash
   pio run -e esp32-air780eg --target upload
   ```

2. **测试步骤**：
   - 输入`info`查看完整设备信息
   - 输入`audio.help`查看音频命令
   - 输入`mqtt.help`查看MQTT命令
   - 测试各种音频播放功能
   - 检查MQTT连接状态

## 注意事项

1. **音频硬件**：确保NS4168芯片正确连接到对应引脚
2. **GSM网络**：确保Air780EG模块有良好的网络信号
3. **MQTT服务器**：确保MQTT服务器`mq-hub.daboluo.cc:32571`可访问
4. **引脚冲突**：注意IMU_INT_PIN已改为GPIO14避免冲突

## 后续优化建议

1. 添加音频音量控制命令
2. 实现MQTT消息订阅状态显示
3. 添加网络质量监控功能
4. 实现音频播放队列管理
